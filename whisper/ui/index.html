<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>WebSocket 测试</title>
    <style>
        body {
            font-family: monospace;
            background: #111;
            color: #0f0;
            padding: 20px;
        }
        #log {
            white-space: pre-wrap;
            border: 1px solid #0f0;
            padding: 10px;
            height: 400px;
            overflow-y: auto;
        }
        button {
            margin-top: 10px;
        }
    </style>
</head>
<body>

<h2>WebSocket 测试页面</h2>

<div id="log">等待连接...\n</div>

<button onclick="sendPing()">发送 ping</button>

<script>
    const logDiv = document.getElementById("log");

    function log(msg) {
        logDiv.textContent += msg + "\n";
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    // ⚠️ 如果前端和后端不在同一台机器，改成服务器 IP
    const ws = new WebSocket("ws://localhost:8001/ws");

    ws.onopen = () => {
        log("[✓] WebSocket 已连接");
    };

    ws.onmessage = (event) => {
        try {
            const data = JSON.parse(event.data);
            log("[←] 收到 JSON：");
            log(JSON.stringify(data, null, 2));
        } catch (e) {
            log("[←] 收到文本：" + event.data);
        }
    };

    ws.onerror = (err) => {
        log("[✗] WebSocket 错误");
        console.error(err);
    };

    ws.onclose = () => {
        log("[×] WebSocket 已关闭");
    };

    function sendPing() {
        if (ws.readyState === WebSocket.OPEN) {
            ws.send("ping");
            log("[→] 发送 ping");
        } else {
            log("[!] WebSocket 未连接");
        }
    }
</script>

</body>
</html>
